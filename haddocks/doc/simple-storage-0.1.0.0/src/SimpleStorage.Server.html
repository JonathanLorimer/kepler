<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">SimpleStorage.Server</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SimpleStorage.Server.html#makeAndServeApplication"><span class="hs-identifier">makeAndServeApplication</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fold</span></span><span class="hs-special">)</span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Endo</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Network.ABCI.Server</span></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">serveApp</span></span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Network.ABCI.Server.App</span></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Middleware</span></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.ABCI.Server.Middleware.Logger</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Logger</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Polysemy</span></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Sem</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="SimpleStorage.Application.html"><span class="hs-identifier">SimpleStorage.Application</span></a></span><span>             </span><span class="hs-special">(</span><span class="annot"><a href="SimpleStorage.Application.html#handlersContext"><span class="hs-identifier">handlersContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="SimpleStorage.Config.html"><span class="hs-identifier">SimpleStorage.Config</span></a></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="SimpleStorage.Config.html#AppConfig"><span class="hs-identifier">AppConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Tendermint.SDK.Application</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">createIOApp</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">makeApp</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Tendermint.SDK.BaseApp</span></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CoreEffs</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runCoreEffs</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="annot"><a href="SimpleStorage.Server.html#makeAndServeApplication"><span class="hs-identifier hs-type">makeAndServeApplication</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="SimpleStorage.Config.html#AppConfig"><span class="hs-identifier hs-type">AppConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span id="makeAndServeApplication"><span class="annot"><span class="annottext">makeAndServeApplication :: AppConfig -&gt; IO ()
</span><a href="SimpleStorage.Server.html#makeAndServeApplication"><span class="hs-identifier hs-var hs-var">makeAndServeApplication</span></a></span></span><span> </span><span id="local-6989586621679293541"><span class="annot"><a href="SimpleStorage.Config.html#AppConfig"><span class="hs-identifier hs-type">AppConfig</span></a></span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Starting ABCI application...&quot;</span></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679293537"><span class="hs-identifier hs-type">nat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679293536"><span class="annot"><a href="#local-6989586621679293536"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Sem</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CoreEffs</span></span><span> </span><span class="annot"><a href="#local-6989586621679293536"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679293536"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-18"></span><span>      </span><span id="local-6989586621679293537"><span class="annot"><span class="annottext">nat :: Sem CoreEffs a -&gt; IO a
</span><a href="#local-6989586621679293537"><span class="hs-identifier hs-var hs-var">nat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; forall a. Sem CoreEffs a -&gt; IO a
</span><span class="hs-identifier hs-var">runCoreEffs</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679293541"><span class="hs-identifier hs-var">_baseAppContext</span></a></span><span>
</span><span id="line-19"></span><span>      </span><span id="local-6989586621679293535"><span class="annot"><span class="annottext">application :: App (Sem CoreEffs)
</span><a href="#local-6989586621679293535"><span class="hs-identifier hs-var hs-var">application</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HandlersContext Secp256k1 SimpleStorageModules CoreEffs
-&gt; App (Sem CoreEffs)
forall k (alg :: k) (ms :: [Component])
       (core :: [(* -&gt; *) -&gt; * -&gt; *]).
(RecoverableSignatureSchema alg, Message alg ~ Digest SHA256,
 Member (Embed IO) core, ToApplication ms (Effs ms core),
 HasTxRouter (ApplicationC ms) (Effs ms core) 'QueryAndMempool,
 HasTxRouter (ApplicationC ms) (BaseAppEffs core) 'QueryAndMempool,
 HasTxRouter (ApplicationD ms) (Effs ms core) 'Consensus,
 HasTxRouter (ApplicationD ms) (BaseAppEffs core) 'Consensus,
 HasQueryRouter (ApplicationQ ms) (Effs ms core),
 HasQueryRouter (ApplicationQ ms) (BaseAppEffs core),
 Eval ms core) =&gt;
HandlersContext alg ms core -&gt; App (Sem core)
</span><span class="hs-identifier hs-var">makeApp</span></span><span> </span><span class="annot"><span class="annottext">HandlersContext Secp256k1 SimpleStorageModules CoreEffs
</span><a href="SimpleStorage.Application.html#handlersContext"><span class="hs-identifier hs-var">handlersContext</span></a></span><span>
</span><span id="line-20"></span><span>      </span><span class="annot"><a href="#local-6989586621679293534"><span class="hs-identifier hs-type">middleware</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Middleware</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Sem</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CoreEffs</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>      </span><span id="local-6989586621679293534"><span class="annot"><span class="annottext">middleware :: Middleware (Sem CoreEffs)
</span><a href="#local-6989586621679293534"><span class="hs-identifier hs-var hs-var">middleware</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Endo (App (Sem CoreEffs)) -&gt; Middleware (Sem CoreEffs)
forall a. Endo a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">appEndo</span></span><span> </span><span class="annot"><span class="annottext">(Endo (App (Sem CoreEffs)) -&gt; Middleware (Sem CoreEffs))
-&gt; ([Endo (App (Sem CoreEffs))] -&gt; Endo (App (Sem CoreEffs)))
-&gt; [Endo (App (Sem CoreEffs))]
-&gt; Middleware (Sem CoreEffs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Endo (App (Sem CoreEffs))] -&gt; Endo (App (Sem CoreEffs))
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="annot"><span class="annottext">([Endo (App (Sem CoreEffs))] -&gt; Middleware (Sem CoreEffs))
-&gt; [Endo (App (Sem CoreEffs))] -&gt; Middleware (Sem CoreEffs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-22"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Middleware (Sem CoreEffs) -&gt; Endo (App (Sem CoreEffs))
forall a. (a -&gt; a) -&gt; Endo a
</span><span class="hs-identifier hs-var">Endo</span></span><span> </span><span class="annot"><span class="annottext">Middleware (Sem CoreEffs)
forall (m :: * -&gt; *). KatipContext m =&gt; Middleware m
</span><span class="hs-identifier hs-var">Logger.mkLoggerM</span></span><span>
</span><span id="line-23"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><span class="annottext">App IO -&gt; IO ()
</span><span class="hs-identifier hs-var">serveApp</span></span><span> </span><span class="annot"><span class="annottext">(App IO -&gt; IO ()) -&gt; App IO -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(forall a. Sem CoreEffs a -&gt; IO a) -&gt; App (Sem CoreEffs) -&gt; App IO
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(forall a. Sem r a -&gt; IO a) -&gt; App (Sem r) -&gt; App IO
</span><span class="hs-identifier hs-var">createIOApp</span></span><span> </span><span class="annot"><span class="annottext">forall a. Sem CoreEffs a -&gt; IO a
</span><a href="#local-6989586621679293537"><span class="hs-identifier hs-var">nat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Middleware (Sem CoreEffs)
</span><a href="#local-6989586621679293534"><span class="hs-identifier hs-var">middleware</span></a></span><span> </span><span class="annot"><span class="annottext">App (Sem CoreEffs)
</span><a href="#local-6989586621679293535"><span class="hs-identifier hs-var">application</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span></pre></body></html>